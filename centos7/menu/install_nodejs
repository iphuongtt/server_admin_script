#!/bin/bash

clear

. /etc/server_admin/menu/color.sh
. /etc/server_admin/menu/global_var
. /etc/server_admin/menu/function.sh

get_user_account() {
	echo -n "Enter user account, do you want to install nodejs: "
	while read username
	do
	if [ "$username" != "" ]; then
	    break
	fi
	echo -n "Username should not be blank, enter your username: "
	done
}

install_nvm() {
	su -c $username -c `wget -qO- https://raw.githubusercontent.com/creationix/nvm/v0.33.11/install.sh | bash`
	if [ $? -eq 0 ]; then
		su - $username -c `source ~/.bash_profile`
		if [ $? -eq 0 ]; then
			return 0
		else
			return 1
		fi
	else
		return 1	
	fi
}

install_nodejs() {
	su - $username -c `nvm install node`
	if [ $? -eq 0 ]; then
		return 0
	else
		return 1
	fi
}

get_user_account

install_nvm &
installed_nvm=$?
PID=$!
i=1
sp="/-\|"
echo -e -n "${BGreen}Installing Node Version Manager...${Color_Off} "
while [ -d /proc/$PID ]
do
  printf "\b${sp:i++%${#sp}:1}"
done
echo -e "${BBlue} Done${Color_Off}"
printf "\n"

if [ $installed_nvm -eq 0 ]; then
	install_nodejs &
	installed_nodejs=$?
	PID=$!
	i=1
	sp="/-\|"
	echo -e -n "${BGreen}Installing NodeJS...${Color_Off} "
	while [ -d /proc/$PID ]
	do
	  printf "\b${sp:i++%${#sp}:1}"
	done
	if [ $installed_nodejs -eq 0 ]; then
		echo -e "${BBlue} Done${Color_Off}"
		printf "\n"
		echo "===================================================================================="
		echo -e "         ${BGreen}INSTALL NODEJS SUCCESSFUL${Color_Off}"
		echo "===================================================================================="
		read -p "Press enter to continue"
		server-admin
		exit;
	else
		read -p "Press enter to continue"
		server-admin
		exit
	fi
else
	read -p "Press enter to continue"
	server-admin
	exit
fi