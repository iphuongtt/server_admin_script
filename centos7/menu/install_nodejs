#!/bin/bash

clear

. /etc/server_admin/menu/color.sh
. /etc/server_admin/menu/global_var

installed_nvm=0
installed_nodejs=0

install_nvm() {
	wget -qO- https://raw.githubusercontent.com/creationix/nvm/v0.33.11/install.sh | bash
	if [ $? -eq 0 ]; then
		source ~/.bash_profile
		if [ $? -eq 0 ]; then
			installed_nvm=1
		else
			installed_nvm=0
		fi
	else
		installed_nvm=0	
	fi
}

install_nodejs() {
	nvm install node
	if [ $? -eq 0 ]; then
		install_nodejs=1
	else
		install_nodejs=0	
	fi
}

install_nvm &
PID=$!
i=1
sp="/-\|"
echo -e -n "${BGreen}Installing Node Version Manager...${Color_Off} "
while [ -d /proc/$PID ]
do
  printf "\b${sp:i++%${#sp}:1}"
done
echo -e "${BBlue} Done${Color_Off}"
printf "\n"

if [ $installed_nvm -eq 1 ]; then
	install_nodejs &
	PID=$!
	i=1
	sp="/-\|"
	echo -e -n "${BGreen}Installing NodeJS...${Color_Off} "
	while [ -d /proc/$PID ]
	do
	  printf "\b${sp:i++%${#sp}:1}"
	done
	if [ $installed_nodejs -eq 1 ]; then
		echo -e "${BBlue} Done${Color_Off}"
		printf "\n"
		echo "===================================================================================="
		echo -e "         ${BGreen}INSTALL NODEJS SUCCESSFUL${Color_Off}"
		echo "===================================================================================="
		read -p "Press enter to continue"
		server-admin
		exit;
	else
		read -p "Press enter to continue"
		server-admin
		exit
	fi
else
	read -p "Press enter to continue"
	server-admin
	exit
fi